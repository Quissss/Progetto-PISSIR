@page
@model Progetto.App.Pages.ParkingModel
@{
    ViewData["Title"] = "Dashboard Parking Lots";
}

<h2>@ViewData["Title"]</h2>

<div id="parkingGrid"></div>

@section Scripts {
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jsgrid/1.5.3/jsgrid.min.js"></script>
    <script>
        const parkings = @Html.Raw(Json.Serialize(Model.Parkings.Select(p => new
            {
                id = p.Id,
                name = p.Name,
                address = p.Address,
                city = p.City,
                province = p.Province,
                postalCode = p.PostalCode,
                country = p.Country,
                energyCostPerMinute = p.EnergyCostPerMinute
            })));
        const url = "/api/Parking";

        let ajax = function (item, verb, json = true) {
            return $.ajax({
                type: verb,
                url: url + (item.id ? "/" + item.id : ""),
                data: json ? JSON.stringify(item) : item,
                dataType: "json",
                contentType: json ? "application/json" : "text/plain",
            });
        };

    

        $(function () {
            $("#parkingGrid").jsGrid({
                width: "100%",
                height: "400px",
                autoload: true,
                filtering: true,
                inserting: true,
                editing: true,
                sorting: true,
                paging: true,
                controller: {
                    loadData: function (filter) {
                        return ajax(filter, "GET", false);
                    },
                    updateItem: function (item) {
                        return ajax(item, "PUT").done(function () {
                            $("#parkingGrid").jsGrid("loadData");
                        });
                    },
                    deleteItem: item => ajax(item, "DELETE"),
                    
                    insertItem: item => ajax(item, "POST"),
                },
           
                data: parkings,
                fields: [
                    { name: "name", type: "text", width: 150, title: "Name" },
                    { name: "address", type: "text", width: 200, title: "Address" },
                    { name: "city", type: "text", width: 100, title: "City" },
                    { name: "province", type: "text", width: 100, title: "Province" },
                    { name: "postalCode", type: "text", width: 100, title: "Postal Code" },
                    { name: "country", type: "text", width: 100, title: "Country" },
                    { name: "energyCostPerMinute", type: "number", width: 100, title: "Energy Cost/Min" },
                    {
                        type: "control",
                        editButton: true,
                        deleteButton: true,
                    }
                ]
            });
        });
    </script>
}
